import torch

# Load the state_dict from a checkpoint file
checkpoint_path = "/workspace/SSC-toolbox/Cylinder3D/configs/model_save_backup.pt"
# Path for the updated checkpoint
new_checkpoint_path = "./new_state_dict.pth"
checkpoint = torch.load(checkpoint_path)
# Adjust if your checkpoint structure differs
state_dict = checkpoint.get("state_dict", checkpoint)

# Define the complete mapping of old names to new names
name_mapping = {
    "cylinder_3d_generator.PPmodel.0.weight": "point_encoder.mlp.0.weight",
    "cylinder_3d_generator.PPmodel.0.bias": "point_encoder.mlp.0.bias",
    "cylinder_3d_generator.PPmodel.0.running_mean": "point_encoder.mlp.0.running_mean",
    "cylinder_3d_generator.PPmodel.0.running_var": "point_encoder.mlp.0.running_var",
    "cylinder_3d_generator.PPmodel.0.num_batches_tracked": "point_encoder.mlp.0.num_batches_tracked",
    "cylinder_3d_generator.PPmodel.1.weight": "point_encoder.mlp.1.weight",
    "cylinder_3d_generator.PPmodel.1.bias": "point_encoder.mlp.1.bias",
    "cylinder_3d_generator.PPmodel.2.weight": "point_encoder.mlp.2.weight",
    "cylinder_3d_generator.PPmodel.2.bias": "point_encoder.mlp.2.bias",
    "cylinder_3d_generator.PPmodel.2.running_mean": "point_encoder.mlp.2.running_mean",
    "cylinder_3d_generator.PPmodel.2.running_var": "point_encoder.mlp.2.running_var",
    "cylinder_3d_generator.PPmodel.2.num_batches_tracked": "point_encoder.mlp.2.num_batches_tracked",
    "cylinder_3d_generator.PPmodel.4.weight": "point_encoder.mlp.4.weight",
    "cylinder_3d_generator.PPmodel.4.bias": "point_encoder.mlp.4.bias",
    "cylinder_3d_generator.PPmodel.5.weight": "point_encoder.mlp.5.weight",
    "cylinder_3d_generator.PPmodel.5.bias": "point_encoder.mlp.5.bias",
    "cylinder_3d_generator.PPmodel.5.running_mean": "point_encoder.mlp.5.running_mean",
    "cylinder_3d_generator.PPmodel.5.running_var": "point_encoder.mlp.5.running_var",
    "cylinder_3d_generator.PPmodel.5.num_batches_tracked": "point_encoder.mlp.5.num_batches_tracked",
    "cylinder_3d_generator.PPmodel.7.weight": "point_encoder.mlp.7.weight",
    "cylinder_3d_generator.PPmodel.7.bias": "point_encoder.mlp.7.bias",
    "cylinder_3d_generator.PPmodel.8.weight": "point_encoder.mlp.8.weight",
    "cylinder_3d_generator.PPmodel.8.bias": "point_encoder.mlp.8.bias",
    "cylinder_3d_generator.PPmodel.8.running_mean": "point_encoder.mlp.8.running_mean",
    "cylinder_3d_generator.PPmodel.8.running_var": "point_encoder.mlp.8.running_var",
    "cylinder_3d_generator.PPmodel.8.num_batches_tracked": "point_encoder.mlp.8.num_batches_tracked",
    "cylinder_3d_generator.PPmodel.10.weight": "point_encoder.mlp.10.weight",
    "cylinder_3d_generator.PPmodel.10.bias": "point_encoder.mlp.10.bias",
    "cylinder_3d_generator.fea_compression.0.weight": "point_encoder.feature_transform.0.weight",
    "cylinder_3d_generator.fea_compression.0.bias": "point_encoder.feature_transform.0.bias",
    "cylinder_3d_spconv_seg.downCntx.conv1.weight": "voxel_segmentor.resblock.skip_connection.0.conv.weight",
    "cylinder_3d_spconv_seg.downCntx.bn0.weight": "voxel_segmentor.resblock.skip_connection.0.bn.weight",
    "cylinder_3d_spconv_seg.downCntx.bn0.bias": "voxel_segmentor.resblock.skip_connection.0.bn.bias",
    "cylinder_3d_spconv_seg.downCntx.bn0.running_mean": "voxel_segmentor.resblock.skip_connection.0.bn.running_mean",
    "cylinder_3d_spconv_seg.downCntx.bn0.running_var": "voxel_segmentor.resblock.skip_connection.0.bn.running_var",
    "cylinder_3d_spconv_seg.downCntx.bn0.num_batches_tracked": "voxel_segmentor.resblock.skip_connection.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.downCntx.conv1_2.weight": "voxel_segmentor.resblock.skip_connection.1.conv.weight",
    "cylinder_3d_spconv_seg.downCntx.bn0_2.weight": "voxel_segmentor.resblock.skip_connection.1.bn.weight",
    "cylinder_3d_spconv_seg.downCntx.bn0_2.bias": "voxel_segmentor.resblock.skip_connection.1.bn.bias",
    "cylinder_3d_spconv_seg.downCntx.bn0_2.running_mean": "voxel_segmentor.resblock.skip_connection.1.bn.running_mean",
    "cylinder_3d_spconv_seg.downCntx.bn0_2.running_var": "voxel_segmentor.resblock.skip_connection.1.bn.running_var",
    "cylinder_3d_spconv_seg.downCntx.bn0_2.num_batches_tracked": "voxel_segmentor.resblock.skip_connection.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.downCntx.conv2.weight": "voxel_segmentor.resblock.residual.0.conv.weight",
    "cylinder_3d_spconv_seg.downCntx.bn1.weight": "voxel_segmentor.resblock.residual.0.bn.weight",
    "cylinder_3d_spconv_seg.downCntx.bn1.bias": "voxel_segmentor.resblock.residual.0.bn.bias",
    "cylinder_3d_spconv_seg.downCntx.bn1.running_mean": "voxel_segmentor.resblock.residual.0.bn.running_mean",
    "cylinder_3d_spconv_seg.downCntx.bn1.running_var": "voxel_segmentor.resblock.residual.0.bn.running_var",
    "cylinder_3d_spconv_seg.downCntx.bn1.num_batches_tracked": "voxel_segmentor.resblock.residual.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.downCntx.conv3.weight": "voxel_segmentor.resblock.residual.1.conv.weight",
    "cylinder_3d_spconv_seg.downCntx.bn2.weight": "voxel_segmentor.resblock.residual.1.bn.weight",
    "cylinder_3d_spconv_seg.downCntx.bn2.bias": "voxel_segmentor.resblock.residual.1.bn.bias",
    "cylinder_3d_spconv_seg.downCntx.bn2.running_mean": "voxel_segmentor.resblock.residual.1.bn.running_mean",
    "cylinder_3d_spconv_seg.downCntx.bn2.running_var": "voxel_segmentor.resblock.residual.1.bn.running_var",
    "cylinder_3d_spconv_seg.downCntx.bn2.num_batches_tracked": "voxel_segmentor.resblock.residual.1.bn.num_batches_tracked",
    # Continue mapping for all your keys
    "cylinder_3d_spconv_seg.resBlock2.conv1.weight": "voxel_segmentor.encoder.0.skip_connection.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn0.weight": "voxel_segmentor.encoder.0.skip_connection.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn0.bias": "voxel_segmentor.encoder.0.skip_connection.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock2.bn0.running_mean": "voxel_segmentor.encoder.0.skip_connection.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock2.bn0.running_var": "voxel_segmentor.encoder.0.skip_connection.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock2.bn0.num_batches_tracked": "voxel_segmentor.encoder.0.skip_connection.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock2.conv1_2.weight": "voxel_segmentor.encoder.0.skip_connection.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn0_2.weight": "voxel_segmentor.encoder.0.skip_connection.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn0_2.bias": "voxel_segmentor.encoder.0.skip_connection.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock2.bn0_2.running_mean": "voxel_segmentor.encoder.0.skip_connection.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock2.bn0_2.running_var": "voxel_segmentor.encoder.0.skip_connection.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock2.bn0_2.num_batches_tracked": "voxel_segmentor.encoder.0.skip_connection.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock2.conv2.weight": "voxel_segmentor.encoder.0.residual.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn1.weight": "voxel_segmentor.encoder.0.residual.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn1.bias": "voxel_segmentor.encoder.0.residual.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock2.bn1.running_mean": "voxel_segmentor.encoder.0.residual.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock2.bn1.running_var": "voxel_segmentor.encoder.0.residual.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock2.bn1.num_batches_tracked": "voxel_segmentor.encoder.0.residual.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock2.conv3.weight": "voxel_segmentor.encoder.0.residual.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn2.weight": "voxel_segmentor.encoder.0.residual.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock2.bn2.bias": "voxel_segmentor.encoder.0.residual.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock2.bn2.running_mean": "voxel_segmentor.encoder.0.residual.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock2.bn2.running_var": "voxel_segmentor.encoder.0.residual.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock2.bn2.num_batches_tracked": "voxel_segmentor.encoder.0.residual.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock2.pool.weight": "voxel_segmentor.encoder.0.pooling.weight",
    "cylinder_3d_spconv_seg.resBlock3.conv1.weight": "voxel_segmentor.encoder.1.skip_connection.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn0.weight": "voxel_segmentor.encoder.1.skip_connection.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn0.bias": "voxel_segmentor.encoder.1.skip_connection.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock3.bn0.running_mean": "voxel_segmentor.encoder.1.skip_connection.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock3.bn0.running_var": "voxel_segmentor.encoder.1.skip_connection.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock3.bn0.num_batches_tracked": "voxel_segmentor.encoder.1.skip_connection.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock3.conv1_2.weight": "voxel_segmentor.encoder.1.skip_connection.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn0_2.weight": "voxel_segmentor.encoder.1.skip_connection.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn0_2.bias": "voxel_segmentor.encoder.1.skip_connection.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock3.bn0_2.running_mean": "voxel_segmentor.encoder.1.skip_connection.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock3.bn0_2.running_var": "voxel_segmentor.encoder.1.skip_connection.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock3.bn0_2.num_batches_tracked": "voxel_segmentor.encoder.1.skip_connection.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock3.conv2.weight": "voxel_segmentor.encoder.1.residual.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn1.weight": "voxel_segmentor.encoder.1.residual.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn1.bias": "voxel_segmentor.encoder.1.residual.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock3.bn1.running_mean": "voxel_segmentor.encoder.1.residual.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock3.bn1.running_var": "voxel_segmentor.encoder.1.residual.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock3.bn1.num_batches_tracked": "voxel_segmentor.encoder.1.residual.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock3.conv3.weight": "voxel_segmentor.encoder.1.residual.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn2.weight": "voxel_segmentor.encoder.1.residual.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock3.bn2.bias": "voxel_segmentor.encoder.1.residual.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock3.bn2.running_mean": "voxel_segmentor.encoder.1.residual.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock3.bn2.running_var": "voxel_segmentor.encoder.1.residual.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock3.bn2.num_batches_tracked": "voxel_segmentor.encoder.1.residual.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock3.pool.weight": "voxel_segmentor.encoder.1.pooling.weight",
    "cylinder_3d_spconv_seg.resBlock4.conv1.weight": "voxel_segmentor.encoder.2.skip_connection.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn0.weight": "voxel_segmentor.encoder.2.skip_connection.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn0.bias": "voxel_segmentor.encoder.2.skip_connection.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock4.bn0.running_mean": "voxel_segmentor.encoder.2.skip_connection.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock4.bn0.running_var": "voxel_segmentor.encoder.2.skip_connection.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock4.bn0.num_batches_tracked": "voxel_segmentor.encoder.2.skip_connection.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock4.conv1_2.weight": "voxel_segmentor.encoder.2.skip_connection.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn0_2.weight": "voxel_segmentor.encoder.2.skip_connection.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn0_2.bias": "voxel_segmentor.encoder.2.skip_connection.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock4.bn0_2.running_mean": "voxel_segmentor.encoder.2.skip_connection.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock4.bn0_2.running_var": "voxel_segmentor.encoder.2.skip_connection.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock4.bn0_2.num_batches_tracked": "voxel_segmentor.encoder.2.skip_connection.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock4.conv2.weight": "voxel_segmentor.encoder.2.residual.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn1.weight": "voxel_segmentor.encoder.2.residual.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn1.bias": "voxel_segmentor.encoder.2.residual.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock4.bn1.running_mean": "voxel_segmentor.encoder.2.residual.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock4.bn1.running_var": "voxel_segmentor.encoder.2.residual.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock4.bn1.num_batches_tracked": "voxel_segmentor.encoder.2.residual.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock4.conv3.weight": "voxel_segmentor.encoder.2.residual.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn2.weight": "voxel_segmentor.encoder.2.residual.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock4.bn2.bias": "voxel_segmentor.encoder.2.residual.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock4.bn2.running_mean": "voxel_segmentor.encoder.2.residual.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock4.bn2.running_var": "voxel_segmentor.encoder.2.residual.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock4.bn2.num_batches_tracked": "voxel_segmentor.encoder.2.residual.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock4.pool.weight": "voxel_segmentor.encoder.2.pooling.weight",
    "cylinder_3d_spconv_seg.resBlock5.conv1.weight": "voxel_segmentor.encoder.3.skip_connection.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn0.weight": "voxel_segmentor.encoder.3.skip_connection.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn0.bias": "voxel_segmentor.encoder.3.skip_connection.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock5.bn0.running_mean": "voxel_segmentor.encoder.3.skip_connection.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock5.bn0.running_var": "voxel_segmentor.encoder.3.skip_connection.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock5.bn0.num_batches_tracked": "voxel_segmentor.encoder.3.skip_connection.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock5.conv1_2.weight": "voxel_segmentor.encoder.3.skip_connection.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn0_2.weight": "voxel_segmentor.encoder.3.skip_connection.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn0_2.bias": "voxel_segmentor.encoder.3.skip_connection.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock5.bn0_2.running_mean": "voxel_segmentor.encoder.3.skip_connection.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock5.bn0_2.running_var": "voxel_segmentor.encoder.3.skip_connection.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock5.bn0_2.num_batches_tracked": "voxel_segmentor.encoder.3.skip_connection.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock5.conv2.weight": "voxel_segmentor.encoder.3.residual.0.conv.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn1.weight": "voxel_segmentor.encoder.3.residual.0.bn.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn1.bias": "voxel_segmentor.encoder.3.residual.0.bn.bias",
    "cylinder_3d_spconv_seg.resBlock5.bn1.running_mean": "voxel_segmentor.encoder.3.residual.0.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock5.bn1.running_var": "voxel_segmentor.encoder.3.residual.0.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock5.bn1.num_batches_tracked": "voxel_segmentor.encoder.3.residual.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock5.conv3.weight": "voxel_segmentor.encoder.3.residual.1.conv.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn2.weight": "voxel_segmentor.encoder.3.residual.1.bn.weight",
    "cylinder_3d_spconv_seg.resBlock5.bn2.bias": "voxel_segmentor.encoder.3.residual.1.bn.bias",
    "cylinder_3d_spconv_seg.resBlock5.bn2.running_mean": "voxel_segmentor.encoder.3.residual.1.bn.running_mean",
    "cylinder_3d_spconv_seg.resBlock5.bn2.running_var": "voxel_segmentor.encoder.3.residual.1.bn.running_var",
    "cylinder_3d_spconv_seg.resBlock5.bn2.num_batches_tracked": "voxel_segmentor.encoder.3.residual.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.resBlock5.pool.weight": "voxel_segmentor.encoder.3.pooling.weight",
    "cylinder_3d_spconv_seg.upBlock0.trans_dilao.weight": "voxel_segmentor.decoder.0.transform.conv.weight",
    "cylinder_3d_spconv_seg.upBlock0.trans_bn.weight": "voxel_segmentor.decoder.0.transform.bn.weight",
    "cylinder_3d_spconv_seg.upBlock0.trans_bn.bias": "voxel_segmentor.decoder.0.transform.bn.bias",
    "cylinder_3d_spconv_seg.upBlock0.trans_bn.running_mean": "voxel_segmentor.decoder.0.transform.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock0.trans_bn.running_var": "voxel_segmentor.decoder.0.transform.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock0.trans_bn.num_batches_tracked": "voxel_segmentor.decoder.0.transform.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock0.conv1.weight": "voxel_segmentor.decoder.0.refinement.0.conv.weight",
    "cylinder_3d_spconv_seg.upBlock0.bn1.weight": "voxel_segmentor.decoder.0.refinement.0.bn.weight",
    "cylinder_3d_spconv_seg.upBlock0.bn1.bias": "voxel_segmentor.decoder.0.refinement.0.bn.bias",
    "cylinder_3d_spconv_seg.upBlock0.bn1.running_mean": "voxel_segmentor.decoder.0.refinement.0.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock0.bn1.running_var": "voxel_segmentor.decoder.0.refinement.0.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock0.bn1.num_batches_tracked": "voxel_segmentor.decoder.0.refinement.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock0.conv2.weight": "voxel_segmentor.decoder.0.refinement.1.conv.weight",
    "cylinder_3d_spconv_seg.upBlock0.bn2.weight": "voxel_segmentor.decoder.0.refinement.1.bn.weight",
    "cylinder_3d_spconv_seg.upBlock0.bn2.bias": "voxel_segmentor.decoder.0.refinement.1.bn.bias",
    "cylinder_3d_spconv_seg.upBlock0.bn2.running_mean": "voxel_segmentor.decoder.0.refinement.1.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock0.bn2.running_var": "voxel_segmentor.decoder.0.refinement.1.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock0.bn2.num_batches_tracked": "voxel_segmentor.decoder.0.refinement.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock0.conv3.weight": "voxel_segmentor.decoder.0.refinement.2.conv.weight",
    "cylinder_3d_spconv_seg.upBlock0.bn3.weight": "voxel_segmentor.decoder.0.refinement.2.bn.weight",
    "cylinder_3d_spconv_seg.upBlock0.bn3.bias": "voxel_segmentor.decoder.0.refinement.2.bn.bias",
    "cylinder_3d_spconv_seg.upBlock0.bn3.running_mean": "voxel_segmentor.decoder.0.refinement.2.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock0.bn3.running_var": "voxel_segmentor.decoder.0.refinement.2.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock0.bn3.num_batches_tracked": "voxel_segmentor.decoder.0.refinement.2.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock0.up_subm.weight": "voxel_segmentor.decoder.0.upsampling.weight",
    "cylinder_3d_spconv_seg.upBlock1.trans_dilao.weight": "voxel_segmentor.decoder.1.transform.conv.weight",
    "cylinder_3d_spconv_seg.upBlock1.trans_bn.weight": "voxel_segmentor.decoder.1.transform.bn.weight",
    "cylinder_3d_spconv_seg.upBlock1.trans_bn.bias": "voxel_segmentor.decoder.1.transform.bn.bias",
    "cylinder_3d_spconv_seg.upBlock1.trans_bn.running_mean": "voxel_segmentor.decoder.1.transform.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock1.trans_bn.running_var": "voxel_segmentor.decoder.1.transform.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock1.trans_bn.num_batches_tracked": "voxel_segmentor.decoder.1.transform.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock1.conv1.weight": "voxel_segmentor.decoder.1.refinement.0.conv.weight",
    "cylinder_3d_spconv_seg.upBlock1.bn1.weight": "voxel_segmentor.decoder.1.refinement.0.bn.weight",
    "cylinder_3d_spconv_seg.upBlock1.bn1.bias": "voxel_segmentor.decoder.1.refinement.0.bn.bias",
    "cylinder_3d_spconv_seg.upBlock1.bn1.running_mean": "voxel_segmentor.decoder.1.refinement.0.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock1.bn1.running_var": "voxel_segmentor.decoder.1.refinement.0.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock1.bn1.num_batches_tracked": "voxel_segmentor.decoder.1.refinement.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock1.conv2.weight": "voxel_segmentor.decoder.1.refinement.1.conv.weight",
    "cylinder_3d_spconv_seg.upBlock1.bn2.weight": "voxel_segmentor.decoder.1.refinement.1.bn.weight",
    "cylinder_3d_spconv_seg.upBlock1.bn2.bias": "voxel_segmentor.decoder.1.refinement.1.bn.bias",
    "cylinder_3d_spconv_seg.upBlock1.bn2.running_mean": "voxel_segmentor.decoder.1.refinement.1.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock1.bn2.running_var": "voxel_segmentor.decoder.1.refinement.1.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock1.bn2.num_batches_tracked": "voxel_segmentor.decoder.1.refinement.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock1.conv3.weight": "voxel_segmentor.decoder.1.refinement.2.conv.weight",
    "cylinder_3d_spconv_seg.upBlock1.bn3.weight": "voxel_segmentor.decoder.1.refinement.2.bn.weight",
    "cylinder_3d_spconv_seg.upBlock1.bn3.bias": "voxel_segmentor.decoder.1.refinement.2.bn.bias",
    "cylinder_3d_spconv_seg.upBlock1.bn3.running_mean": "voxel_segmentor.decoder.1.refinement.2.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock1.bn3.running_var": "voxel_segmentor.decoder.1.refinement.2.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock1.bn3.num_batches_tracked": "voxel_segmentor.decoder.1.refinement.2.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock1.up_subm.weight": "voxel_segmentor.decoder.1.upsampling.weight",
    "cylinder_3d_spconv_seg.upBlock2.trans_dilao.weight": "voxel_segmentor.decoder.2.transform.conv.weight",
    "cylinder_3d_spconv_seg.upBlock2.trans_bn.weight": "voxel_segmentor.decoder.2.transform.bn.weight",
    "cylinder_3d_spconv_seg.upBlock2.trans_bn.bias": "voxel_segmentor.decoder.2.transform.bn.bias",
    "cylinder_3d_spconv_seg.upBlock2.trans_bn.running_mean": "voxel_segmentor.decoder.2.transform.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock2.trans_bn.running_var": "voxel_segmentor.decoder.2.transform.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock2.trans_bn.num_batches_tracked": "voxel_segmentor.decoder.2.transform.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock2.conv1.weight": "voxel_segmentor.decoder.2.refinement.0.conv.weight",
    "cylinder_3d_spconv_seg.upBlock2.bn1.weight": "voxel_segmentor.decoder.2.refinement.0.bn.weight",
    "cylinder_3d_spconv_seg.upBlock2.bn1.bias": "voxel_segmentor.decoder.2.refinement.0.bn.bias",
    "cylinder_3d_spconv_seg.upBlock2.bn1.running_mean": "voxel_segmentor.decoder.2.refinement.0.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock2.bn1.running_var": "voxel_segmentor.decoder.2.refinement.0.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock2.bn1.num_batches_tracked": "voxel_segmentor.decoder.2.refinement.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock2.conv2.weight": "voxel_segmentor.decoder.2.refinement.1.conv.weight",
    "cylinder_3d_spconv_seg.upBlock2.bn2.weight": "voxel_segmentor.decoder.2.refinement.1.bn.weight",
    "cylinder_3d_spconv_seg.upBlock2.bn2.bias": "voxel_segmentor.decoder.2.refinement.1.bn.bias",
    "cylinder_3d_spconv_seg.upBlock2.bn2.running_mean": "voxel_segmentor.decoder.2.refinement.1.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock2.bn2.running_var": "voxel_segmentor.decoder.2.refinement.1.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock2.bn2.num_batches_tracked": "voxel_segmentor.decoder.2.refinement.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock2.conv3.weight": "voxel_segmentor.decoder.2.refinement.2.conv.weight",
    "cylinder_3d_spconv_seg.upBlock2.bn3.weight": "voxel_segmentor.decoder.2.refinement.2.bn.weight",
    "cylinder_3d_spconv_seg.upBlock2.bn3.bias": "voxel_segmentor.decoder.2.refinement.2.bn.bias",
    "cylinder_3d_spconv_seg.upBlock2.bn3.running_mean": "voxel_segmentor.decoder.2.refinement.2.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock2.bn3.running_var": "voxel_segmentor.decoder.2.refinement.2.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock2.bn3.num_batches_tracked": "voxel_segmentor.decoder.2.refinement.2.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock2.up_subm.weight": "voxel_segmentor.decoder.2.upsampling.weight",
    "cylinder_3d_spconv_seg.upBlock3.trans_dilao.weight": "voxel_segmentor.decoder.3.transform.conv.weight",
    "cylinder_3d_spconv_seg.upBlock3.trans_bn.weight": "voxel_segmentor.decoder.3.transform.bn.weight",
    "cylinder_3d_spconv_seg.upBlock3.trans_bn.bias": "voxel_segmentor.decoder.3.transform.bn.bias",
    "cylinder_3d_spconv_seg.upBlock3.trans_bn.running_mean": "voxel_segmentor.decoder.3.transform.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock3.trans_bn.running_var": "voxel_segmentor.decoder.3.transform.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock3.trans_bn.num_batches_tracked": "voxel_segmentor.decoder.3.transform.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock3.conv1.weight": "voxel_segmentor.decoder.3.refinement.0.conv.weight",
    "cylinder_3d_spconv_seg.upBlock3.bn1.weight": "voxel_segmentor.decoder.3.refinement.0.bn.weight",
    "cylinder_3d_spconv_seg.upBlock3.bn1.bias": "voxel_segmentor.decoder.3.refinement.0.bn.bias",
    "cylinder_3d_spconv_seg.upBlock3.bn1.running_mean": "voxel_segmentor.decoder.3.refinement.0.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock3.bn1.running_var": "voxel_segmentor.decoder.3.refinement.0.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock3.bn1.num_batches_tracked": "voxel_segmentor.decoder.3.refinement.0.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock3.conv2.weight": "voxel_segmentor.decoder.3.refinement.1.conv.weight",
    "cylinder_3d_spconv_seg.upBlock3.bn2.weight": "voxel_segmentor.decoder.3.refinement.1.bn.weight",
    "cylinder_3d_spconv_seg.upBlock3.bn2.bias": "voxel_segmentor.decoder.3.refinement.1.bn.bias",
    "cylinder_3d_spconv_seg.upBlock3.bn2.running_mean": "voxel_segmentor.decoder.3.refinement.1.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock3.bn2.running_var": "voxel_segmentor.decoder.3.refinement.1.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock3.bn2.num_batches_tracked": "voxel_segmentor.decoder.3.refinement.1.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock3.conv3.weight": "voxel_segmentor.decoder.3.refinement.2.conv.weight",
    "cylinder_3d_spconv_seg.upBlock3.bn3.weight": "voxel_segmentor.decoder.3.refinement.2.bn.weight",
    "cylinder_3d_spconv_seg.upBlock3.bn3.bias": "voxel_segmentor.decoder.3.refinement.2.bn.bias",
    "cylinder_3d_spconv_seg.upBlock3.bn3.running_mean": "voxel_segmentor.decoder.3.refinement.2.bn.running_mean",
    "cylinder_3d_spconv_seg.upBlock3.bn3.running_var": "voxel_segmentor.decoder.3.refinement.2.bn.running_var",
    "cylinder_3d_spconv_seg.upBlock3.bn3.num_batches_tracked": "voxel_segmentor.decoder.3.refinement.2.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.upBlock3.up_subm.weight": "voxel_segmentor.decoder.3.upsampling.weight",
    "cylinder_3d_spconv_seg.ReconNet.conv1.weight": "voxel_segmentor.reconblock.recon_r.conv.weight",
    "cylinder_3d_spconv_seg.ReconNet.bn0.weight": "voxel_segmentor.reconblock.recon_r.bn.weight",
    "cylinder_3d_spconv_seg.ReconNet.bn0.bias": "voxel_segmentor.reconblock.recon_r.bn.bias",
    "cylinder_3d_spconv_seg.ReconNet.bn0.running_mean": "voxel_segmentor.reconblock.recon_r.bn.running_mean",
    "cylinder_3d_spconv_seg.ReconNet.bn0.running_var": "voxel_segmentor.reconblock.recon_r.bn.running_var",
    "cylinder_3d_spconv_seg.ReconNet.bn0.num_batches_tracked": "voxel_segmentor.reconblock.recon_r.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.ReconNet.conv1_2.weight": "voxel_segmentor.reconblock.recon_theta.conv.weight",
    "cylinder_3d_spconv_seg.ReconNet.bn0_2.weight": "voxel_segmentor.reconblock.recon_theta.bn.weight",
    "cylinder_3d_spconv_seg.ReconNet.bn0_2.bias": "voxel_segmentor.reconblock.recon_theta.bn.bias",
    "cylinder_3d_spconv_seg.ReconNet.bn0_2.running_mean": "voxel_segmentor.reconblock.recon_theta.bn.running_mean",
    "cylinder_3d_spconv_seg.ReconNet.bn0_2.running_var": "voxel_segmentor.reconblock.recon_theta.bn.running_var",
    "cylinder_3d_spconv_seg.ReconNet.bn0_2.num_batches_tracked": "voxel_segmentor.reconblock.recon_theta.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.ReconNet.conv1_3.weight": "voxel_segmentor.reconblock.recon_z.conv.weight",
    "cylinder_3d_spconv_seg.ReconNet.bn0_3.weight": "voxel_segmentor.reconblock.recon_z.bn.weight",
    "cylinder_3d_spconv_seg.ReconNet.bn0_3.bias": "voxel_segmentor.reconblock.recon_z.bn.bias",
    "cylinder_3d_spconv_seg.ReconNet.bn0_3.running_mean": "voxel_segmentor.reconblock.recon_z.bn.running_mean",
    "cylinder_3d_spconv_seg.ReconNet.bn0_3.running_var": "voxel_segmentor.reconblock.recon_z.bn.running_var",
    "cylinder_3d_spconv_seg.ReconNet.bn0_3.num_batches_tracked": "voxel_segmentor.reconblock.recon_z.bn.num_batches_tracked",
    "cylinder_3d_spconv_seg.logits.weight": "voxel_segmentor.classifier.weight",
    "cylinder_3d_spconv_seg.logits.bias": "voxel_segmentor.classifier.bias",
}

# Create a new state_dict with renamed keys
new_state_dict = {}
for old_name, value in state_dict.items():
    if old_name in name_mapping:
        new_name = name_mapping[old_name]
        new_state_dict[new_name] = value
    else:
        # Retain keys that don't need renaming
        raise ValueError(f"Key {old_name} not found in name_mapping")


# Save the updated checkpoint
torch.save(new_state_dict, new_checkpoint_path)
print(f"Updated checkpoint saved to {new_checkpoint_path}")
